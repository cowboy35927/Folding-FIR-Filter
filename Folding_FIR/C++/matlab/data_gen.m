Fs = 8000; %Sampling rate = 8kHz
N = 40000;   %Sample size

fid_in = fopen("input_24bits.txt");
A = fscanf(fid_in, "%f", N);
data_in = A';

coeff = [-0.002964894749042235391756072715452319244,
 0.005015861152363371849860484985583752859,
 0.020667893101735827776632703489667619579,
 0.025148888112610387479683993205981096253,
 0.002316865275779686830781578521509800339,
-0.025779624933500097649918814113334519789,
-0.015946518131217442965086306116972991731,
 0.029216940020626670782011302662795060314,
 0.042349361155728501571182675888849189505,
-0.02019719422775444889195384234881203156 ,
-0.085611751306674921391248744839685969055,
-0.021255965443284792482092626642042887397,
 0.191877715214637978302647525197244249284,
 0.391355121984242604327164372080005705357,
 0.391355121984242604327164372080005705357,
 0.191877715214637978302647525197244249284,
-0.021255965443284792482092626642042887397,
-0.085611751306674921391248744839685969055,
-0.02019719422775444889195384234881203156 ,
 0.042349361155728501571182675888849189505,
 0.029216940020626670782011302662795060314,
-0.015946518131217442965086306116972991731,
-0.025779624933500097649918814113334519789,
 0.002316865275779686830781578521509800339,
 0.025148888112610387479683993205981096253,
 0.020667893101735827776632703489667619579,
 0.005015861152363371849860484985583752859,
-0.002964894749042235391756072715452319244];

data_out = conv(data_in*(2^15), coeff*(2^15))*(2^-15);

figure
subplot(2, 1, 1);
[DATA_IN, din_freq_range] = positive_fft(data_in, Fs);
stem(din_freq_range, abs(DATA_IN));
xlabel('Frequency (Hz)');
ylabel('Amplitude');
axis([0 4000 0 0.025]);

subplot(2, 1, 2);
[DATA_OUT, dout_freq_range] = positive_fft(data_out, Fs);
stem(dout_freq_range, abs(DATA_OUT));
xlabel('Frequency (Hz)');
ylabel('Amplitude');
axis([0 4000 0 0.025]);

figure
subplot(2, 1, 1);
plot(data_in);
xlabel('Before Filtration');
axis([1 40000 -1.5 1.5]);

subplot(2, 1, 2);
plot(data_out);
xlabel('After Filtration');
axis([1 40023 -1.5 1.5]);

%output file
% fid_coeff = fopen('coeff.txt', 'wt');
% fid_out = fopen('output_24bits.txt', 'wt');
% for i=1:24
%     fprintf(fid_coeff, '%f\n', coeff(i));
% end
% 
% for i=1:40023
%     fprintf(fid_out, '%f\n', data_out(i));
% end